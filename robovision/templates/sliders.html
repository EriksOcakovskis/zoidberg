<!DOCTYPE html>
<html lang="en">
<html>
  <head>
     <meta charset="UTF-8">
    <title>Slidershurrdurr</title>
    <!-- // <script src="http://egert.ee/bl0at3r/for.js"></script> -->
    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='nouislider.css') }}">
    <script  type="text/javascript" src="{{ url_for('static',filename='nouislider.js') }}"></script>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href= "{{url_for('static', filename='webpage.css') }}">

  </head>
  <body>

    <div class="home-menu pure-menu pure-menu-horizontal pure-menu-fixed">
        <a class="pure-menu-heading" href="">Ministry of silly robots</a>

        <ul class="pure-menu-list">
            <li class="pure-menu-item"><a href="#" class="pure-menu-link">Home</a></li>
            <li class="pure-menu-item  pure-menu-selected"><a href="#" class="pure-menu-link">Camera <i class="fa fa-camera"></i></a></li>
            
            <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
              <a href="#" id="menuLink1" class="pure-menu-link">Status <i class="fa fa-battery-quarter"></i> </a>
              <ul class="pure-menu-children">
                  <li class="pure-menu-item"><a href="#" class="pure-menu-link">Battery 25% <i class="fa fa-battery-quarter"></i></a></li>
                  <li class="pure-menu-item"><a href="#" class="pure-menu-link">CPU Load 35% 
                    <i class="fa fa-cog fa-spin"></i></a></li>
                  <li class="pure-menu-item"><a href="#" class="pure-menu-link">Compassion 0% <i class="fa fa-heart"></i>
                    </a></li>
              </ul>
            </li>

            <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
            <a href="#" id="menuLink1" class="pure-menu-link">Halp <i class="fa fa-beer"></i></i> </a>
            <ul class="pure-menu-children">
                <li class="pure-menu-item"><a href="#" class="pure-menu-link">Colors update after release</a></li>
                <li class="pure-menu-item"><a href="#" class="pure-menu-link">You can drag from the middle</a></li>
                <li class="pure-menu-item"><a href="#" class="pure-menu-link">Dong anger the robots</a></li>
                <li class="pure-menu-item"><a href="#" class="pure-menu-link">They smell fear</a></li>
                
            </ul>
            </li>
            <li class="pure-menu-item"><a href="https://github.com/egaia/python-pythonize-robots" class="pure-menu-link">Git hub <i class="fa fa-github"></i></a></li>
        </li>
        </ul>
    </div>
  
<div class="center">
  <img style="-webkit-user-select: none" src="/video">

  <div class="colorPicker"> 
    <div class="no-ui-slider" id="picker">
      <br><div class="sliders" id="H"   data-min = "0" data-max = "180"  data-start="15"  data-end="30" ></div>
      <br><div class="sliders" id="S" data-min = "0" data-max = "255"  data-start="130" data-end="255"></div>
      <br><div class="sliders" id="V"  data-min = "0" data-max = "255"  data-start="130" data-end="255"></div>
      <br><div class="display" id="lower" ></div>
      <div class="display" id="upper" ></div>
    </div>
  </div>
</div>



<script type="text/javascript">
function hsv_to_hsl(h, s, v) {
    h = h/180;
    s = s/255;
    v = v/255;
    // both hsv and hsl values are in [0, 1]
    var l = (2 - s) * v / 2;
    if (l != 0) {
        if (l == 1) {
            s = 0
        } else if (l < 0.5) {
            s = s * v / (l * 2)
        } else {
            s = s * v / (2 - l * 2)
        }
    }
    return [Math.round(h*360), Math.round(s*100), Math.round(l*100)]
  }

function setColor(){
  var lower = document.getElementById('lower');
  var upper = document.getElementById('upper');

  var blH = sliders[0].noUiSlider.get()[0];
  var blS = sliders[1].noUiSlider.get()[0];
  var blV = sliders[2].noUiSlider.get()[0];
  var bhH = sliders[0].noUiSlider.get()[1];
  var bhS = sliders[1].noUiSlider.get()[1];
  var bhV = sliders[2].noUiSlider.get()[1];

  var lowerConvert = hsv_to_hsl(blH,blS,blV);
  var lowerColor = 'hsl(' +
        lowerConvert[0]+ ',' +
        lowerConvert[1]+ '%,' +
        lowerConvert[2]+ '%)';  
  var upperConvert = hsv_to_hsl(bhH,bhS,bhV);
  var upperColor = 'hsl(' +
        upperConvert[0]+ ',' +
        upperConvert[1]+ '%,' +
        upperConvert[2]+ '%)';
  // Fill the color box.
  upper.style.background = upperColor;
  upper.style.color = upperColor;
  lower.style.background = lowerColor;
  lower.style.color = lowerColor;

  // server side ajax stuff
    var query = "blH="+blH+"&blS="+blS+"&blV="+blV+"&bhH="+bhH+"&bhS="+bhS+"&bhV="+bhV+"";
    console.log(query);
    $.ajax({
        url: "/camera/config",
        type:'POST',
        data: query,
        success: function(msg)
        {
            console.log(msg,query);
        }              
    });
}

var  sliders = $( "#picker" ).find(".sliders");
for ( var i = 0; i < 3; i++ ) {
  var min   = parseInt(sliders[i].getAttribute("data-min"));
  var max   = parseInt(sliders[i].getAttribute("data-max"));
  var start = parseInt(sliders[i].getAttribute("data-start"));
  var end   = parseInt(sliders[i].getAttribute("data-end"));
  noUiSlider.create(sliders[i], {
    start: [start,end],
    behaviour: 'drag',
    animate: false,
    step: 1,
    connect: true,
    tooltips:true,
    range: {      'min': min,      'max': max    },
    format: {
      to: function ( value ) {      return Math.round(value);    },
      from: function ( value ) {     return value;    }
  }
  });
  sliders[i].noUiSlider.on('change', setColor);
}
setColor();



</script>
<script type="text/javascript"> 
function submitForm() {
    console.log($("#data").serialize());
    $.ajax({
        url: "/camera/config",
        type:'POST',
        data: $("#data").serialize(),
        success: function(msg)
        {
            console.log(msg);
        }              
    });
}
</script>

  </body>
</html>
